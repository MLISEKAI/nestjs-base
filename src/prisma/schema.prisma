generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserBasicRole {
  admin
  user
  guest
}

enum ProviderEnum {
  anonymous
  phone
  facebook
  microsoft
  google
  apple
  password
}

enum PostReaction {
  like
  love
  haha
  wow
  sad
  angry
}

// USER BASE MODEL
model ResUser {
  id         String    @id @default(uuid())
  created_at DateTime  @default(now())
  updated_at DateTime  @updatedAt
  deleted_at DateTime?
  is_deleted Boolean   @default(false)

  // Base
  union_id   String        @unique
  role       UserBasicRole @default(guest)
  nickname   String
  is_blocked Boolean       @default(false)

  bio      String?
  avatar   String?
  gender   String?
  birthday DateTime?

  // --- Relations ---
  associates   ResAssociate[]
  albums       ResAlbum[]
  followers    ResFollow[]    @relation("Followers")
  following    ResFollow[]    @relation("Following")
  blockedBy    ResBlock[]     @relation("BlockedBy")
  blocking     ResBlock[]     @relation("Blocking")
  friendsA     ResFriend[]    @relation("FriendsA")
  friendsB     ResFriend[]    @relation("FriendsB")
  messagesSent ResMessage[]   @relation("MessagesSent")
  messagesRecv ResMessage[]   @relation("MessagesRecv")
  giftsSent    ResGift[]      @relation("GiftsSent")
  giftsRecv    ResGift[]      @relation("GiftsRecv")

  wallets        ResWallet[]
  vipStatus      ResVipStatus?
  depositAddress ResDepositAddress?
  storeItems     ResStoreItem[]
  tasks          ResTask[]
  clans          ResUserClan[]

  loveSpace          ResLoveSpace?
  feedbacks          ResFeedback[]
  location           ResLocation?
  contributions      ResContribution?
  interests          ResInterest[]
  roomStatus         ResRoomStatus?
  post               ResPost[]
  postComments       ResComment[]           @relation("CommentAuthor")
  postLikes          ResPostLike[]
  postShares         ResPostShare[]
  hashtagFollows     ResHashtagFollow[]
  stories            ResStory[]
  groupMembers       ResGroupMember[]
  groupMessages      ResGroupMessage[]
  eventsCreated      ResEvent[]             @relation("EventCreator")
  eventParticipants  ResEventParticipant[]
  giftMilestones     ResGiftMilestone[]
  walletTransactions ResWalletTransaction[]
  inventories        ResInventory[]

  supporters           ResSupporter[]        @relation("UserSupported") // Người này được supporter
  supporting           ResSupporter[]        @relation("UserSupporter") // Người này đi supporter người khác
  referralsAsReferrer  ResReferral[]         @relation("Referrer")
  referralsAsReferred  ResReferral[]         @relation("Referred")
  profileViewsAsViewer ResProfileView[]      @relation("Viewer")
  profileViewsAsTarget ResProfileView[]      @relation("Target")
  relationships        ResRelationship[]     @relation("UserRelationships")
  relationshipsRelated ResRelationship[]     @relation("UserRelated")
  verificationCodes    ResVerificationCode[]
  refreshTokens        ResRefreshToken[]
  blacklistedTokens    ResTokenBlacklist[]
  twoFactor            ResTwoFactor?
  notificationsSent    ResNotification[]     @relation("NotificationSender")
  notificationsRecv    ResNotification[]     @relation("NotificationReceiver")

  @@index([union_id, deleted_at])
  @@index([union_id])
  @@map("res_user")
}

// ASSOCIATE
model ResAssociate {
  id         String    @id @default(uuid())
  created_at DateTime  @default(now())
  updated_at DateTime  @updatedAt
  deleted_at DateTime?
  is_deleted Boolean   @default(false)

  // Base
  user_id        String
  email          String?
  phone_number   String?
  ref_id         String
  hash           String?
  provider       ProviderEnum
  email_verified Boolean      @default(false)
  phone_verified Boolean      @default(false)

  // Relation
  user ResUser @relation(fields: [user_id], references: [id])

  @@index([ref_id])
  @@index([user_id])
  @@map("res_associate")
}

// Album
model ResAlbum {
  id         String   @id @default(uuid())
  created_at DateTime @default(now())
  title      String
  user_id    String
  image_url  String

  user   ResUser         @relation(fields: [user_id], references: [id])
  photos ResAlbumPhoto[]

  @@index([user_id])
  @@map("res_album")
}

// ALBUM PHOTO
model ResAlbumPhoto {
  id         String   @id @default(uuid())
  album_id   String
  image_url  String
  created_at DateTime @default(now())

  album ResAlbum @relation(fields: [album_id], references: [id])

  @@index([album_id])
  @@map("res_album_photo")
}

// FOLLOW
model ResFollow {
  id         String   @id @default(uuid())
  created_at DateTime @default(now())

  follower_id  String
  following_id String

  follower  ResUser @relation("Followers", fields: [follower_id], references: [id])
  following ResUser @relation("Following", fields: [following_id], references: [id])

  @@unique([follower_id, following_id])
  @@index([follower_id])
  @@index([following_id])
  @@map("res_follow")
}

// BLOCK USER
model ResBlock {
  id         String   @id @default(uuid())
  created_at DateTime @default(now())

  blocker_id String // User who blocks
  blocked_id String // User who is blocked

  blocker ResUser @relation("Blocking", fields: [blocker_id], references: [id], onDelete: Cascade)
  blocked ResUser @relation("BlockedBy", fields: [blocked_id], references: [id], onDelete: Cascade)

  @@unique([blocker_id, blocked_id])
  @@index([blocker_id])
  @@index([blocked_id])
  @@map("res_block")
}

// FRIEND
model ResFriend {
  id         String   @id @default(uuid())
  created_at DateTime @default(now())

  user_a_id String
  user_b_id String

  userA ResUser @relation("FriendsA", fields: [user_a_id], references: [id])
  userB ResUser @relation("FriendsB", fields: [user_b_id], references: [id])

  @@unique([user_a_id, user_b_id])
  @@map("res_friend")
}

// MESSAGE (TIN NHẮN)
model ResMessage {
  id         String   @id @default(uuid())
  created_at DateTime @default(now())

  sender_id   String
  receiver_id String
  content     String

  sender   ResUser @relation("MessagesSent", fields: [sender_id], references: [id])
  receiver ResUser @relation("MessagesRecv", fields: [receiver_id], references: [id])

  @@index([sender_id])
  @@index([receiver_id])
  @@index([receiver_id, created_at])
  @@index([created_at])
  @@map("res_message")
}

// GIFT (QUÀ TẶNG)
model ResGift {
  id           String   @id @default(uuid())
  created_at   DateTime @default(now())
  sender_id    String
  receiver_id  String
  gift_item_id String
  message      String?
  quantity     Int      @default(1)

  sender   ResUser     @relation("GiftsSent", fields: [sender_id], references: [id], onDelete: Cascade)
  receiver ResUser     @relation("GiftsRecv", fields: [receiver_id], references: [id], onDelete: Cascade)
  giftItem ResGiftItem @relation(fields: [gift_item_id], references: [id], onDelete: Cascade)

  @@index([sender_id])
  @@index([receiver_id])
  @@index([receiver_id, created_at])
  @@index([created_at])
  @@map("res_gift")
}

model ResGiftCategory {
  id           String        @id @default(uuid())
  name         String
  resGiftItems ResGiftItem[]

  @@map("res_gift_category")
}

model ResGiftItem {
  id          String  @id @default(uuid())
  category_id String
  name        String
  image_url   String?
  price       Decimal @db.Decimal(10, 2)
  type        String? // normal | vip | event
  event_id    String? // Link với event nếu là gift của event

  gifts ResGift[]

  category ResGiftCategory @relation(fields: [category_id], references: [id], onDelete: Cascade)
  event    ResEvent?       @relation(fields: [event_id], references: [id], onDelete: SetNull)

  @@index([category_id])
  @@index([type])
  @@index([event_id])
  @@index([category_id, type])
  @@map("res_gift_item")
}

model ResGiftMilestone {
  id          String   @id @default(uuid())
  user_id     String
  milestone   Int
  current     Int      @default(0)
  reward_name String?
  icon_url    String?
  is_unlocked Boolean  @default(false)
  created_at  DateTime @default(now())
  user        ResUser  @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id])
  @@index([user_id, is_unlocked])
  @@map("res_gift_milestone")
}

// WALLET
model ResWallet {
  id           String                 @id @default(uuid())
  user_id      String
  balance      Decimal                @default(0) @db.Decimal(12, 2)
  currency     String                 @default("gem")
  created_at   DateTime               @default(now())
  updated_at   DateTime               @updatedAt
  transactions ResWalletTransaction[]
  user         ResUser                @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([user_id, currency])
  @@index([user_id])
  @@map("res_wallet")
}

enum WalletTransactionType {
  deposit
  withdraw
  gift
  convert
  transfer
  subscription
}

enum WalletTransactionStatus {
  pending
  success
  failed
}

enum WalletCurrency {
  gem
  vex
}

model ResWalletTransaction {
  id             String                  @id @default(uuid())
  wallet_id      String
  user_id        String
  type           WalletTransactionType
  amount         Decimal                 @db.Decimal(12, 2)
  balance_before Decimal?                @db.Decimal(12, 2)
  balance_after  Decimal?                @db.Decimal(12, 2)
  status         WalletTransactionStatus @default(pending)
  reference_id   String?
  created_at     DateTime                @default(now())

  wallet ResWallet @relation(fields: [wallet_id], references: [id], onDelete: Cascade)
  user   ResUser   @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id])
  @@index([wallet_id])
  @@index([created_at])
  @@map("res_wallet_transaction")
}

// RECHARGE PACKAGE
model ResRechargePackage {
  id         String   @id @default(uuid())
  package_id Int      @unique
  diamonds   Int
  price      Decimal  @db.Decimal(12, 2)
  bonus      String?
  is_active  Boolean  @default(true)
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  @@index([package_id])
  @@index([is_active])
  @@map("res_recharge_package")
}

// MONTHLY CARD
model ResMonthlyCard {
  id             String   @id @default(uuid())
  card_id        Int      @unique
  name           String
  price          Decimal  @db.Decimal(12, 2)
  diamonds_daily Int
  duration       Int      @default(30) // days
  is_active      Boolean  @default(true)
  created_at     DateTime @default(now())
  updated_at     DateTime @updatedAt

  @@index([card_id])
  @@index([is_active])
  @@map("res_monthly_card")
}

// PAYMENT METHOD
model ResPaymentMethod {
  id          String   @id @default(uuid())
  method_id   String   @unique
  name        String
  type        String // card, subscription, crypto
  masked_info String?
  is_active   Boolean  @default(true)
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt

  @@index([method_id])
  @@index([is_active])
  @@map("res_payment_method")
}

// DEPOSIT ADDRESS
model ResDepositAddress {
  id              String   @id @default(uuid())
  user_id         String   @unique
  deposit_address String
  qr_code         String?
  network         String   @default("Ethereum")
  created_at      DateTime @default(now())
  updated_at      DateTime @updatedAt
  user            ResUser  @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id])
  @@map("res_deposit_address")
}

// VIP STATUS
model ResVipStatus {
  id      String    @id @default(uuid())
  user_id String    @unique
  is_vip  Boolean   @default(false)
  expiry  DateTime?
  user    ResUser   @relation(fields: [user_id], references: [id])

  @@map("res_vip_status")
}

// STORE ITEM
model ResStoreItem {
  id      String   @id @default(uuid())
  name    String
  price   Decimal
  user_id String?
  user    ResUser? @relation(fields: [user_id], references: [id])

  @@map("res_store_item")
}

// TASKS
model ResTask {
  id      String  @id @default(uuid())
  user_id String
  title   String
  is_done Boolean @default(false)
  user    ResUser @relation(fields: [user_id], references: [id])

  @@map("res_task")
}

// INVENTORY
model ResInventory {
  id       String @id @default(uuid())
  user_id  String
  item_id  String
  quantity Int    @default(1)

  user ResUser @relation(fields: [user_id], references: [id], onDelete: Cascade)
  item ResItem @relation(fields: [item_id], references: [id], onDelete: Cascade)

  @@unique([user_id, item_id])
  @@map("res_inventory")
}

model ResItem {
  id          String         @id @default(uuid())
  name        String
  type        String?
  rarity      String?
  price       Decimal?       @db.Decimal(10, 2)
  image_url   String?
  inventories ResInventory[]

  @@map("res_item")
}

// CLAN
model ResClan {
  id      String        @id @default(uuid())
  name    String
  members ResUserClan[]

  @@map("res_clan")
}

model ResUserClan {
  id      String  @id @default(uuid())
  user_id String
  clan_id String
  rank    String
  user    ResUser @relation(fields: [user_id], references: [id])
  clan    ResClan @relation(fields: [clan_id], references: [id])

  @@map("res_user_clan")
}

// REFERRAL
model ResReferral {
  id            String   @id @default(uuid())
  referrer_id   String
  referred_id   String
  reward_amount Int      @default(0)
  created_at    DateTime @default(now())
  referrer      ResUser  @relation("Referrer", fields: [referrer_id], references: [id])
  referred      ResUser  @relation("Referred", fields: [referred_id], references: [id])

  @@unique([referrer_id, referred_id])
  @@map("res_referral")
}

// PROFILE VIEWS
model ResProfileView {
  id             String   @id @default(uuid())
  viewer_id      String
  target_user_id String
  viewed_at      DateTime @default(now())
  viewer         ResUser  @relation("Viewer", fields: [viewer_id], references: [id])
  target_user    ResUser  @relation("Target", fields: [target_user_id], references: [id])

  @@index([viewer_id])
  @@index([target_user_id])
  @@map("res_profile_view")
}

//New
// Love Space
model ResLoveSpace {
  id         String   @id @default(uuid())
  user_id    String   @unique
  bio        String?
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  user ResUser @relation(fields: [user_id], references: [id])

  @@map("res_love_space")
}

// Company Info
model ResCompany {
  id         String   @id @default(uuid())
  name       String
  address    String?
  phone      String?
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  @@map("res_company")
}

// Support Info
model ResSupportInfo {
  id         String   @id @default(uuid())
  email      String
  phone      String?
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  @@map("res_support_info")
}

// Help Article
model ResHelpArticle {
  id         String   @id @default(uuid())
  title      String
  content    String
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  @@map("res_help_article")
}

// Feedback
model ResFeedback {
  id         String   @id @default(uuid())
  user_id    String
  content    String
  created_at DateTime @default(now())
  user       ResUser  @relation(fields: [user_id], references: [id])

  @@map("res_feedback")
}

// Location
model ResLocation {
  id         String   @id @default(uuid())
  user_id    String   @unique
  lat        Float
  lng        Float
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
  user       ResUser  @relation(fields: [user_id], references: [id])

  @@map("res_location")
}

// Contribution
model ResContribution {
  id         String   @id @default(uuid())
  user_id    String   @unique
  points     Int      @default(0)
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
  user       ResUser  @relation(fields: [user_id], references: [id])

  @@map("res_contribution")
}

// Interest
model ResInterest {
  id      String  @id @default(uuid())
  user_id String
  name    String
  user    ResUser @relation(fields: [user_id], references: [id])

  @@map("res_interest")
}

// Supporter
model ResSupporter {
  id           String @id @default(uuid())
  user_id      String
  supporter_id String
  amount       Int

  user      ResUser @relation("UserSupported", fields: [user_id], references: [id], onDelete: Cascade)
  supporter ResUser @relation("UserSupporter", fields: [supporter_id], references: [id], onDelete: Cascade)
}

// Relationship
model ResRelationship {
  id              String @id @default(uuid())
  user_id         String
  related_user_id String
  type            String

  user         ResUser @relation("UserRelationships", fields: [user_id], references: [id])
  related_user ResUser @relation("UserRelated", fields: [related_user_id], references: [id])

  @@map("res_relationship")
}

// Room Status
model ResRoomStatus {
  id      String  @id @default(uuid())
  user_id String  @unique
  status  String
  user    ResUser @relation(fields: [user_id], references: [id])

  @@map("res_room_status")
}

enum PostPrivacy {
  public
  private
  friends
}

model ResPost {
  id          String      @id @default(uuid())
  user_id     String
  content     String
  privacy     PostPrivacy @default(public)
  share_count Int         @default(0)
  created_at  DateTime    @default(now())
  updated_at  DateTime    @updatedAt

  user     ResUser          @relation(fields: [user_id], references: [id])
  comments ResComment[]
  likes    ResPostLike[]
  media    ResPostMedia[]
  hashtags ResPostHashtag[]
  shares   ResPostShare[]

  @@index([user_id])
  @@index([created_at])
  @@index([privacy])
  @@map("res_post")
}

// POST COMMENT
model ResComment {
  id         String   @id @default(uuid())
  post_id    String
  user_id    String
  content    String
  parent_id  String? // For nested comments/replies
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  post    ResPost      @relation(fields: [post_id], references: [id], onDelete: Cascade)
  user    ResUser      @relation("CommentAuthor", fields: [user_id], references: [id], onDelete: Cascade)
  parent  ResComment?  @relation("CommentReplies", fields: [parent_id], references: [id], onDelete: Cascade)
  replies ResComment[] @relation("CommentReplies")

  @@index([post_id])
  @@index([user_id])
  @@index([parent_id])
  @@index([created_at])
  @@map("res_comment")
}

// POST LIKE/REACTION
model ResPostLike {
  id         String       @id @default(uuid())
  post_id    String
  user_id    String
  reaction   PostReaction @default(like)
  created_at DateTime     @default(now())

  post ResPost @relation(fields: [post_id], references: [id], onDelete: Cascade)
  user ResUser @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([post_id, user_id])
  @@index([post_id])
  @@index([user_id])
  @@map("res_post_like")
}

// POST MEDIA ATTACHMENT
model ResPostMedia {
  id            String   @id @default(uuid())
  post_id       String
  media_url     String
  thumbnail_url String?
  media_type    String // image, video, audio, file
  width         Int?
  height        Int?
  order         Int      @default(0)
  created_at    DateTime @default(now())

  post ResPost @relation(fields: [post_id], references: [id], onDelete: Cascade)

  @@index([post_id])
  @@index([post_id, order])
  @@map("res_post_media")
}

// HASHTAG
model ResHashtag {
  id          String   @id @default(uuid())
  name        String   @unique
  post_count  Int      @default(0)
  view_count  Int      @default(0)
  cover_image String?
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt

  posts     ResPostHashtag[]
  followers ResHashtagFollow[]

  @@index([name])
  @@index([post_count])
  @@map("res_hashtag")
}

// POST HASHTAG (Many-to-Many)
model ResPostHashtag {
  id         String   @id @default(uuid())
  post_id    String
  hashtag_id String
  created_at DateTime @default(now())

  post    ResPost    @relation(fields: [post_id], references: [id], onDelete: Cascade)
  hashtag ResHashtag @relation(fields: [hashtag_id], references: [id], onDelete: Cascade)

  @@unique([post_id, hashtag_id])
  @@index([post_id])
  @@index([hashtag_id])
  @@map("res_post_hashtag")
}

// HASHTAG FOLLOW
model ResHashtagFollow {
  id         String   @id @default(uuid())
  user_id    String
  hashtag_id String
  created_at DateTime @default(now())

  user    ResUser    @relation(fields: [user_id], references: [id], onDelete: Cascade)
  hashtag ResHashtag @relation(fields: [hashtag_id], references: [id], onDelete: Cascade)

  @@unique([user_id, hashtag_id])
  @@index([user_id])
  @@index([hashtag_id])
  @@map("res_hashtag_follow")
}

// POST SHARE (Track who shared)
model ResPostShare {
  id         String   @id @default(uuid())
  post_id    String
  user_id    String
  created_at DateTime @default(now())

  post ResPost @relation(fields: [post_id], references: [id], onDelete: Cascade)
  user ResUser @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([post_id, user_id])
  @@index([post_id])
  @@index([user_id])
  @@map("res_post_share")
}

// STORY/STATUS
model ResStory {
  id         String   @id @default(uuid())
  user_id    String
  content    String?
  media_url  String?
  media_type String? // image, video
  expires_at DateTime // Stories expire after 24 hours
  created_at DateTime @default(now())

  user ResUser @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id])
  @@index([expires_at])
  @@index([created_at])
  @@map("res_story")
}

// GROUP/CHAT ROOM
model ResGroup {
  id          String   @id @default(uuid())
  name        String
  description String?
  avatar      String?
  is_public   Boolean  @default(false)
  created_by  String
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt

  members  ResGroupMember[]
  messages ResGroupMessage[]

  @@index([created_by])
  @@index([is_public])
  @@map("res_group")
}

// GROUP MEMBER
model ResGroupMember {
  id        String   @id @default(uuid())
  group_id  String
  user_id   String
  role      String   @default("member") // admin, moderator, member
  joined_at DateTime @default(now())

  group ResGroup @relation(fields: [group_id], references: [id], onDelete: Cascade)
  user  ResUser  @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([group_id, user_id])
  @@index([group_id])
  @@index([user_id])
  @@map("res_group_member")
}

// GROUP MESSAGE
model ResGroupMessage {
  id         String   @id @default(uuid())
  group_id   String
  user_id    String
  content    String
  created_at DateTime @default(now())

  group ResGroup @relation(fields: [group_id], references: [id], onDelete: Cascade)
  user  ResUser  @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([group_id])
  @@index([user_id])
  @@index([group_id, created_at])
  @@map("res_group_message")
}

// EVENT/CALENDAR
model ResEvent {
  id               String    @id @default(uuid())
  created_by       String
  title            String
  description      String?
  location         String?
  start_time       DateTime
  end_time         DateTime?
  is_public        Boolean   @default(false)
  max_participants Int?
  created_at       DateTime  @default(now())
  updated_at       DateTime  @updatedAt

  creator      ResUser               @relation("EventCreator", fields: [created_by], references: [id], onDelete: Cascade)
  participants ResEventParticipant[]
  giftItems    ResGiftItem[]

  @@index([created_by])
  @@index([start_time])
  @@index([is_public])
  @@map("res_event")
}

// EVENT PARTICIPANT
model ResEventParticipant {
  id        String   @id @default(uuid())
  event_id  String
  user_id   String
  status    String   @default("going") // going, maybe, not_going
  joined_at DateTime @default(now())

  event ResEvent @relation(fields: [event_id], references: [id], onDelete: Cascade)
  user  ResUser  @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([event_id, user_id])
  @@index([event_id])
  @@index([user_id])
  @@map("res_event_participant")
}

model ResTokenBlacklist {
  id         String   @id @default(uuid())
  user_id    String?
  jti        String   @unique
  reason     String?
  expires_at DateTime
  created_at DateTime @default(now())

  user ResUser? @relation(fields: [user_id], references: [id])

  @@index([expires_at])
  @@map("res_token_blacklist")
}

model ResVerificationCode {
  id          String               @id @default(uuid())
  user_id     String?
  target      String
  type        VerificationCodeType
  code        String
  expires_at  DateTime
  verified_at DateTime?
  attempts    Int                  @default(0)
  context     String?
  created_at  DateTime             @default(now())

  user ResUser? @relation(fields: [user_id], references: [id])

  @@index([target, type])
  @@map("res_verification_code")
}

model ResRefreshToken {
  id             String    @id @default(uuid())
  user_id        String
  token_hash     String
  expires_at     DateTime
  revoked_at     DateTime?
  created_at     DateTime  @default(now())
  created_by_ip  String?
  replaced_by_id String?

  user ResUser @relation(fields: [user_id], references: [id])

  @@index([user_id])
  @@map("res_refresh_token")
}

// NOTIFICATION
enum NotificationType {
  MESSAGE
  FOLLOW
  LIKE
  COMMENT
  GIFT
  POST
  SYSTEM
}

enum NotificationStatus {
  UNREAD
  READ
}

model ResNotification {
  id         String   @id @default(uuid())
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  user_id   String // Người nhận notification
  sender_id String? // Người gửi (null nếu là system notification)
  type      NotificationType
  status    NotificationStatus @default(UNREAD)
  title     String
  content   String
  data      String? // JSON data for additional info
  link      String? // Link to related content

  user   ResUser  @relation("NotificationReceiver", fields: [user_id], references: [id], onDelete: Cascade)
  sender ResUser? @relation("NotificationSender", fields: [sender_id], references: [id], onDelete: SetNull)

  @@index([user_id, status])
  @@index([user_id, created_at])
  @@index([status])
  @@map("res_notification")
}

model ResTwoFactor {
  id           String    @id @default(uuid())
  user_id      String    @unique
  secret       String
  enabled      Boolean   @default(false)
  verified_at  DateTime?
  backup_codes String[]  @default([])
  created_at   DateTime  @default(now())
  updated_at   DateTime  @updatedAt

  user ResUser @relation(fields: [user_id], references: [id])

  @@map("res_two_factor")
}

enum VerificationCodeType {
  email
  phone
}
